<!doctype html>
<html class="theme-next muse">
<head>
  <title> HybridStart v1.0开发纪要 | 前端路上 </title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />


  <meta name="keywords" content="混合应用,HybridStart," />




<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0" rel="stylesheet" type="text/css" />
<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />



  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />

<meta name="description" content="自混合应用前端开发框架HybridStart v1.0升级计划开始后，经过近一周的开发测试，现已发布预览版，基本实现了最初定下的四个目标：核心易用、UI可剥离、开发模式清晰、开发体验优秀，这也是我理想中的以web前端技术为主的，混合应用开发的正确姿势。在这个过程中将一些笼统的思路细化并落地，也将一些过去思路不对的地方推倒了重构，在通用性方面也做了更多的考量，下面就从核心和UI两大部分入手，详细拆解">
<meta property="og:type" content="article">
<meta property="og:title" content="HybridStart v1.0开发纪要">
<meta property="og:url" content="https://refined-x.com/2017/07/07/HybridStart v1.0开发纪要/index.html">
<meta property="og:site_name" content="前端路上">
<meta property="og:description" content="自混合应用前端开发框架HybridStart v1.0升级计划开始后，经过近一周的开发测试，现已发布预览版，基本实现了最初定下的四个目标：核心易用、UI可剥离、开发模式清晰、开发体验优秀，这也是我理想中的以web前端技术为主的，混合应用开发的正确姿势。在这个过程中将一些笼统的思路细化并落地，也将一些过去思路不对的地方推倒了重构，在通用性方面也做了更多的考量，下面就从核心和UI两大部分入手，详细拆解">
<meta property="og:updated_time" content="2018-11-09T05:39:47.460Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HybridStart v1.0开发纪要">
<meta name="twitter:description" content="自混合应用前端开发框架HybridStart v1.0升级计划开始后，经过近一周的开发测试，现已发布预览版，基本实现了最初定下的四个目标：核心易用、UI可剥离、开发模式清晰、开发体验优秀，这也是我理想中的以web前端技术为主的，混合应用开发的正确姿势。在这个过程中将一些笼统的思路细化并落地，也将一些过去思路不对的地方推倒了重构，在通用性方面也做了更多的考量，下面就从核心和UI两大部分入手，详细拆解">
<script src="//msite.baidu.com/sdk/c.js?appid=1585542911827735"></script>
<link rel="canonical" href="https://refined-x.com/2017/07/07/HybridStart v1.0开发纪要/" />
<script type="application/ld+json">
    {
        "@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
        "@id": "https://refined-x.com/2017/07/07/HybridStart v1.0开发纪要/",
        "appid": "1585542911827735",
        "title": "HybridStart v1.0开发纪要",
        "images": [],
        "description": "自混合应用前端开发框架HybridStart v1.0升级计划开始后，经过近一周的开发测试，现已发布预览版，基本实现了最初定下的四个目标：核心易用、UI可剥离、开发模式清晰、开发体验优秀，这也是...",
        "pubDate":  "2018-11-09T05:39:40" 
    }
</script>

<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"right","display":"always"},
    fancybox: false,
    motion: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?f10103677155b485824f29def715eb5d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>
<body itemscope itemtype="https://schema.org/WebPage" lang="zh-Hans">
  
  
    
  
  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="https://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  
  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">前端路上</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">枪在手，跟我走，前端路上不回头</p>
</div>
<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>
<nav class="site-nav">
  
  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-前端路上">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            前端路上
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            文章归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端简历">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            前端简历
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端作品">
          <a href="/projects/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-fire"></i> <br />
            
            前端作品
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端导航">
          <a href="/navigation/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            前端导航
          </a>
        </li>
      
        
        <li class="menu-item menu-item-编程之外">
          <a href="/other/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-font"></i> <br />
            
            编程之外
          </a>
        </li>
      
        
        <li class="menu-item menu-item-友情链接">
          <a href="/friends/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-link"></i> <br />
            
            友情链接
          </a>
        </li>
      
      
    </ul>
  
  
</nav> </div>
    </header>
    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
    
  
  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="https://schema.org/Article">
    
      <header class="post-header">
        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                HybridStart v1.0开发纪要
              
            
          </h1>
        
        <div class="post-meta">
          
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-07T14:58:47+08:00" content="2017-07-07">
              2017-07-07
            </time>
          </span>
          <span class="post-category" >
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
              <i class="fa fa-folder-o"></i>
            </span>
            <span class="post-meta-item-text">作者：</span>
            <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
              <a href="https://refined-x.com" itemprop="url" rel="index">
                <span itemprop="name">雅X共赏</span>
              </a>
            </span>
          </span>
          <span class="post-count">
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
              <i class="fa pencil-square-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计：</span>
            <span>5.7k</span>
          </span>
          <span class="post-count">
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
              <i class="fa fa-book"></i>
            </span>
            <span class="post-meta-item-text">阅读时长：</span>
            <span>19min</span>
          </span>
          
          
          
          
          
        </div>
      </header>
    
    <div class="post-body" itemprop="articleBody">
      
      
      
        <p>自混合应用前端开发框架<code>HybridStart v1.0</code><a href="//refined-x.com/2017/07/03/%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF%E6%A2%B3%E7%90%86/">升级计划</a>开始后，经过近一周的开发测试，现已发布<a href="https://github.com/tower1229/HybridStart" target="_blank" rel="external">预览版</a>，基本实现了最初定下的四个目标：核心易用、UI可剥离、开发模式清晰、开发体验优秀，这也是我理想中的以web前端技术为主的，混合应用开发的正确姿势。在这个过程中将一些笼统的思路细化并落地，也将一些过去思路不对的地方推倒了重构，在通用性方面也做了更多的考量，下面就从核心和UI两大部分入手，详细拆解一下升级后的HybridStart。</p>
<h2 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h2><h3 id="移除依赖"><a href="#移除依赖" class="headerlink" title="移除依赖"></a>移除依赖</h3><p>之前的<code>core.js</code>直接集成部分第三方插件，并且内部实现也互相依赖，这对于不同技术栈的开发者来说很不友好，比如有的开发者喜欢用Vue做模板渲染，那他看到依赖jQuery后心里一定恶心无比，因此要做的第一件事就是移除核心库的依赖。</p>
<p>移除掉jQuery势必就要自己动手做一个<code>util</code>工具类，以简化原生JavaScript语法，这里我偷了个懒直接把mui的部分代码拿过来，稍作修剪和扩充就ok了。在功能取舍方面，除了满足核心库的需求外还增加了少数几个常用操作，使这部分功能对外开放后能一定程度上发挥jQuery的作用，通过<code>app.util</code>可以获取到这个内部工具集合，经过内置示例的开发体验，应该说只要DOM操作不是很重的情况，基本可以让jQuery歇息了，当然前提是大量的jQuery语法糖都不能用了，其实用习惯了原生语法，会觉得除了单词长一点也并没有多麻烦。</p>
<h3 id="功能梳理"><a href="#功能梳理" class="headerlink" title="功能梳理"></a>功能梳理</h3><p>框架功能都挂载在<code>app</code>对象上，主要提供这五类功能：核心功能、窗口操作、数据操作、设备访问、原生控件。</p>
<h4 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h4><p>核心功能以APP运行周期内的事件或操作为主，比如各种事件监听、按键监听，全局事件的发布/订阅，原生能力就绪的回调方法等，这些方法都直接挂载在<code>app</code>对象上，例如<code>app.ready(callback)</code>。</p>
<p>着重说一下原生能力就绪回调，HybridStart里一个典型的页面js文件是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * script</span><br><span class="line"> */</span><br><span class="line">define(function(require) &#123;</span><br><span class="line">    require(&apos;sdk/common&apos;);</span><br><span class="line">    var $ = app.util;</span><br><span class="line">    //立即执行</span><br><span class="line"></span><br><span class="line">    app.ready(function() &#123;</span><br><span class="line">    //runtime就绪</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>可以看到正文明显被<code>app.ready()</code>方法分隔成上下两部分，上面空白处的代码将在页面加载后立即执行，ready回调内的代码将等待原生能力就绪后被执行，我们鼓励将所有不需要原生能力的操作放在上面，以提升脚本响应速度，这个没什么问题。</p>
<p>但可能遇到的一个问题是，如果一个依赖原生能力的功能被开发者立即执行了，将会因为runtime未就绪而报错，也就是说需要开发者明确的知道那些功能依赖runtime哪些不依赖，如果试图解决这个问题很容易想到的一个办法是，将所有依赖runtime的功能在内部用ready方法包裹一下，这样表面上可以解决问题，但因为ready的异步特性，可能导致代码执行顺序与书写顺序不一致，这无疑是不可接受的。最终在两者间做了妥协，将这些功能在内部用另一个readyEval方法包裹，readyEval方法仅仅在检测到runtime未就绪时给控制台抛出调试信息，而不会中断后续代码的执行，算是一个容错性的处理吧。</p>
<h4 id="窗口操作"><a href="#窗口操作" class="headerlink" title="窗口操作"></a>窗口操作</h4><p>窗口操作包括对window和frame的常用操作，比如打开、关闭、移动、执行脚本等，这些方法都挂载在<code>app.window</code>对象上，例如<code>app.window.open()</code>。</p>
<p>作为最基础也最常用的操作，封装目标就是易用，比如打开窗口这个操作，即便有了<code>app.window.open()</code>也仍然觉得不够简单，因此进一步封装了<code>app.openView()</code>，可以说让绝大多数场景下的打开窗口变得极致简单了，看下两个方法的对比：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.window.open(&#123;</span><br><span class="line">    url:&apos;./view/member/index/temp.html&apos;,</span><br><span class="line">    pageParam: &#123;</span><br><span class="line">        id: 123</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.openView(123, &apos;member&apos;, &apos;index&apos;);</span><br></pre></td></tr></table></figure></p>
<p>openView方法的详细介绍可以参见<a href="//refined-x.com/2017/06/26/%E5%9F%BA%E4%BA%8EAPICloud%E7%9A%84%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/">这里</a>，openView的参数传递是借助本地存储实现的，这次升级也为其配套了一个获取参数的方法<code>app.getParam()</code>，专门用来获取openView方法传递的参数，并且支持对象类型的存取。</p>
<h4 id="内建机制"><a href="#内建机制" class="headerlink" title="内建机制"></a>内建机制</h4><p>简化开发另一个很重要的方向是内建机制，举个例子，实现会员退出登录，需要跳转到登录页同时关闭所有后台页面，关闭后台页面的功能apicloud提供了，但本着<em>尽量不使用特定平台提供的特殊能力</em>原则，这个功能在框架中用另一种方式实现了，而且使用起来超简单，比如可以这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.openView(&#123;</span><br><span class="line">    closeback: true</span><br><span class="line">&#125;, &apos;member&apos;, &apos;login&apos;);</span><br></pre></td></tr></table></figure></p>
<p>内部实现是，每一个页面打开后会在window上挂载一个”isBack”属性，通过监听本窗口的前后台状态更改这个属性的值，当openView方法的closeback被设置为<code>true</code>时，将在打开新页面前在本地存储埋下一个标记，新页面打开后通过这个标记得知自己的任务，然后发布一个相应的全局事件，所有页面都能通过这个事件得知自己的任务，比如任务是<em>关闭后台页面</em>，那么就会检查自己的<code>window.isBack</code>属性，发现是真值就关闭自身，从而完成这个任务。</p>
<p>其实就是利用全局通信能力建立起来的关闭机制，依据这个思路，还可以扩展出打开新窗口同时关闭自身的方法，比如订单提交场景，提交成功后通常会跳转到一个提示页，但是我们不希望从这个提示页可以返回到刚才的提交订单页，所以希望打开提示页的同时关闭订单页，那么实现的代码将是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.openView(&#123;</span><br><span class="line">    closeself: true</span><br><span class="line">&#125;, &apos;shop&apos;,&apos;orderSubmitSuccess&apos;)</span><br></pre></td></tr></table></figure></p>
<p><code>closeself</code>与<code>closeback</code>的区别仅仅是给当前页面增加了一个”closeByNew”的属性，然后本地存储埋了另外一个标记，发布了另外一个任务，新页面打开后照例发布全局事件公布任务，订单页收到任务后发现自己具有”closeByNew”属性，于是关闭了自身。</p>
<p>这些功能都集成在openView方法的配置中，说起来很罗嗦，用起来确特别简单，这类问题只在安卓系统上有，因为IOS没有返回键，只要界面不提供返回按钮用户是不可能随意返回上一个页面的。</p>
<p>框架另外还做了一件事，就是为frame页面的window对象扩展了一个”selfTop”属性，属性值是当前frame距离屏幕顶部的距离，这个值当在frame需要打开带界面的原生插件时很有用，比如打开百度地图，需要你指定地图距离屏幕顶部的距离，如果frame不知道自己距离屏幕顶部有多远，就不可能知道这个值应该是多少，这也算一个隐性需求，不用不知道，用了都说好。</p>
<h4 id="数据操作"><a href="#数据操作" class="headerlink" title="数据操作"></a>数据操作</h4><p>数据操作分为数据请求和数据存储两块内容。</p>
<p><strong>数据请求</strong>也就是<code>app.ajax()</code>方法，主要用来异步获取数据，当然也包括上传和下载，但他们都被单独封装成了插件，这里不做讨论。</p>
<p><code>app.ajax()</code>在易用性上的改进体现为增加了默认错误处理，约定交互格式以及格式检查，api风格几乎照搬<code>jQuery.ajax</code>，没有太多值得说的。在此基础上<code>app.ajax()</code>还针对APP开发场景做了两项功能扩展，一是请求加密，二是快照式缓存。</p>
<p>请求加密通过默认集成的加密模块<code>app.crypto</code>实现，加密算法为3DES，加密后的所有Ajax请求将集中发送到一个url地址，本次请求的真实url和参数以特定方式组织并加密，并将密文以参数形式发送，服务端需要有对应的解密方法得知请求url和参数，并将返回数据也做3DES加密返回给前端，前端解密后得到真实数据，整个过程中的关键是3DES算法的<code>secret</code>，这个值使用apicloud提供的加密存储方式存储，APP被反编译也无法拿到这个密匙，因此理论上实现不可逆加密。至于加密请求为什么要集中发送到一个url，其实是因为之前有的项目后端是这样处理的，如果要修改这个加密逻辑其实也很简单，详细的加密过程参考文档，这里不做赘述（如果发现文档没写完，也请不要奇怪- -!）。</p>
<p>ajax缓存功能apicloud的原生接口也有提供，不过他的缓存是没有更新机制的，一次缓存终生使用，除非做全局的缓存清理，简单说，这个功能很鸡肋。<code>app.ajax()</code>专门增加了一种快照式缓存，每一次请求成功后都会将结果保存为快照，下次这个请求再发起时会先将快照结果返回，待真实数据到达后再返回真实数据，也就是说启用快照缓存的请求将执行两次回调，这个听起来有点奇葩，但应用场景确很普遍，比如说打开一个列表页，通常要有一个loading然后请求到数据后显示到页面上，而使用快照缓存的结果是，打开页面马上呈现最近一次的数据，待新数据拿到后再更新一次页面，我认为这是体验更佳的方式。</p>
<p>可能有的同学会想，如果单纯只是渲染页面还好，万一请求数据后还有一些业务操作，那你执行两次肯定是不行的，没错，为了解决这个问题，快照数据如果是对象的话，会自动为这个数据增加一个”snapshoot”属性，你可以通过检测这个属性来得知当前数据是否为快照，以避免业务操作重复执行。</p>
<p>快照缓存目前来看的问题是，没有做新数据与快照是否相同的检测，导致如果两次数据相同，也会让页面白白重新渲染一次，后续会考虑改进这个功能。</p>
<p><strong>数据存储</strong>模块提供本地数据的增删改查功能，适用于少量应用数据的存储方法挂载在<code>app.storage</code>对象上，比如<code>app.storage.val()</code>。</p>
<p>因为是依托<code>localStorage</code>实现的，所以原来不支持对象类型的存取，这次升级支持了对象类型，其实也就是内部自动做了转化；另外增加了一个<code>app.storage.clear()</code>方法，用来清除存储的数据，但我们常常会有一些数据是希望能不受影响的、持久的存储，比如用户信息、权限等等，那么可以将这些值的key加到配置文件中的<code>appcfg.set.safeStorage</code>安全存储项目里，多个值用逗号隔开，”clear”方法默认会跳过不清理这些存储项，除非启用强制清理。</p>
<p>顺带说另外一个相关的配置<code>appcfg.set.temporary</code>临时存储，这个配置的意思是这些值每次APP退出后都将自动清除。</p>
<h5 id="设备访问"><a href="#设备访问" class="headerlink" title="设备访问"></a>设备访问</h5><p>设备访问能力提供对手机硬件的信息获取和其他操作能力，比如获取系统信息、拨打电话、安装文件等等，他们被挂载在<code>app.device</code>对象上，例如<code>app.device.call()</code>。</p>
<p>这部分就是单纯的封装引擎功能，没什么可说的，目前支持的功能并不很多，因为这些东西我用的不多，不确定哪些是必要的，所以这部分有待后期观察，再做调整。</p>
<h4 id="原生控件"><a href="#原生控件" class="headerlink" title="原生控件"></a>原生控件</h4><p>原生控件就是系统自带的UI控件，比如loading、alert、confirm、actionSheet等，因为还比较常用所以直接挂载到了<code>app</code>对象上，比如<code>app.alert()</code>。</p>
<p>这部分一开始我还纠结要不要封装，因为他们应该归到UI层面，既然是UI的东西核心里不应该集成，但想了想，目前apicloud没有一个拿得出手的同类插件，总得有东西用啊，所以就封装进来了。这肯定不是个长久之计，因为大部分安卓系统的原生控件实在太丑，这个后期再想想办法，争取解决掉。</p>
<p>目前有一个不成熟的思路是用web来做，但web有一个致命的问题是可能受到frame窗口的限制，无法做到模态，还可能被其他控件遮挡，这个问题可以通过打开一个透明window来解决，在这个window上显示控件，操作后再隐藏到底层去，可能的问题有两个，一个是响应速度不知道够不够快，再就是跨窗口通信内容比较多，可能导致实现很复杂，进一步拖慢速度。最好还是找到一个靠谱的原生插件。</p>
<h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><h3 id="css组件"><a href="#css组件" class="headerlink" title="css组件"></a>css组件</h3><p>框架自带一套css组件放在<code>sdk/ui.css</code>中，这次经过小幅修改，着重删掉了一些冗余代码和微调了部分组件的样式。</p>
<p>为了实现<em>UI可剥离</em>，放弃了之前做的主题功能，这个主题功能简单说就是页面一开始是隐藏的，模板引擎解析得到主题css后动态插入页面才让页面显示出来，从性能角度讲放弃这种做法也算是走上了正道，但我记得之前在一次项目中发现，部分安卓机会出现页面打开之初先按照物理分辨率解析，随后布局抖动再恢复为像素分辨率，感觉是webview打开过程发生了一个异步的调整，这个体验是毁灭性的，主题功能的另一个作用就是解决这个问题，不过现在我已经找不到那台测试机了，目前这个问题是否还存在是未知的，有待经过实际项目检验。</p>
<p>如果不满意这套UI是可以直接抛弃掉的，跟框架其他部分几乎没有耦合，如果感觉还能凑合用，换主题功能就只能通过修改<code>less</code>文件来实现了，<code>less</code>文件估计将在文档写完后放出，在这之前暂时只能手动改样式了。</p>
<h3 id="js插件"><a href="#js插件" class="headerlink" title="js插件"></a>js插件</h3><p>框架内置了部分常用插件，比如图片轮显、相册、各种选择器、滚动加载、图片懒加载等等，体验都还不错，部分来自<a href="//refined-x.com/Flow-UI/docs/">Flow-UI</a>的插件库，针对移动端做了微调，使用上还是一贯的模块化。</p>
<p>虽然有了<code>app.util</code>之后就不再提倡使用jQuery了，但如果有人在乎的话，内置jQuery的版本已经升级到3.x。</p>
<p>原来内置在<code>core.js</code>里的<code>etpl</code>也成为了一个插件模块，用来实现前端页面渲染。应该说开发混合应用免不了大量的页面渲染，Vue当然是最好用的工具之一，但把一个功能完备的MVVM框架拿来做渲染，总觉得的有点冗余，而且依我过去的项目经验，大部分渲染其实都是单向的，也就是展示型的，需要将界面操作反应到数据中的情况不太多，在这种情况下，单从代码利用率的角度讲前端模板引擎是“实惠”的选择。</p>
<p>但模板引擎的使用体验比Vue差太多了，先要解析模板，再应用数据，最后填充到页面中，为了减轻这部分负担插件库中提供了一个<a href="https://flow-ui.refined-x.com/docs.html#Render(%E6%B8%B2%E6%9F%93%E5%99%A8" target="_blank" rel="external">Render</a>)插件，可以实现<code>数据=&gt;界面</code>的单向绑定，除了不是双向绑定，在渲染操作上已经接近Vue的体验了，当然差别还是有的，因为内部是使用<code>etpl</code>实现的，并没有高大上的差量更新，所以大范围的页面更新理论上效率不如Vue，这个有待低端机测试，千元以上的手机应该不太会看出差别。</p>
<p>当然，这些也都属于UI，可以用自己喜欢的任意方案替换掉。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>还有一些功能，散布在框架<code>sdk/</code>里的common.js和server.js中，严格来说这些代码已经不属于框架核心范畴，开发者可以根据自己的业务情况做删改，但其中有一些还是很实用的，举个例子。</p>
<p>不知道大家有没有发现，apicloud在引擎层面对页面显示做了优化，打开一个页面前多少会有一点停顿，猜测是在页面没有完全渲染完之前不会开始进场动画，因此有动态渲染内容的页面打开会很迟钝，纯静态的页面打开就利索很多，虽然这可以有效解决布局闪动的问题，但有时候这并不是开发者想要的，而造成打开速度差异的最重要原因就是图片元素的加载，所以为了解决这个问题，我们可以先将页面里的图片”src”值赋给”data-src”，使图片不会立即加载，当页面显示完毕后再将”data-src”赋给”src”以加载图片，从而绕过引擎的优化方案，提升页面打开的响应速度，这个操作已经在框架默认的<code>sdk/common.js</code>中实现了，并在示例APP中部分应用，效果明显。</p>
<p>common.js和server.js中还有很多实用的功能，比如图片自动缓存、给按钮添加点击效果、封装获取经纬度功能、通过经纬度反查地址功能、推送功能等等，具体有啥就自己去看吧，这里不一一列举了。</p>
<h2 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h2><h3 id="瓶颈明显"><a href="#瓶颈明显" class="headerlink" title="瓶颈明显"></a>瓶颈明显</h3><p>混合应用目前的体验确实不理想，为此我还特地对比性的研究了下Dcloud，感觉文档好专业好极客，各种优化手段好极致，但他们的体验APP也并有明显的流畅性差异，所以我甚至认为，这就是以web技术为主的混合应用开发模式的瓶颈，这种体验跟当下大家对主流APP的期待已经产生了不小的差距，做混合应用很重要的一项工作就是修补这些瑕疵。</p>
<p>要说apicloud跟Dcloud完全没差别也是不准确的，粗略的看至少有两点apicloud不如Dcloud做的好，第一是apicloud的后台页面更容易被回收，当连续打开几个apicloud应用页面后切到其他稍微重一点的APP操作一会儿，再切回apicloud，然后返回上一个页面会发现页面已经空白了，需要重新渲染；同样的手机同样的场景Dcloud应用不存在这个问题。第二是apicloud缺少页面预加载功能，Dcloud的示例应用中利用预加载做了列表到详细页最佳实践，有力证明了预加载的价值，而这个需求被提交给apicloud后，管理员的回复是</p>
<blockquote>
<p>“打开页面其实用不着进行预加载，正常的openWin打开然后加载已经足够了。”</p>
</blockquote>
<p>最终示例APP中只能勉强用frame模拟了详细页预加载，用frame模拟的缺点有两个，一是frame无法实现“推入”效果，只能“飞入”，因此可能与APP的全局页面切换效果相违背；第二点更致命，因为frame是依赖window的，也就是说不同的列表页无法共享预加载的详细页，即便同一个列表页只要退出了，下次进来也需要重新预加载详细页。</p>
<h3 id="曲线救国"><a href="#曲线救国" class="headerlink" title="曲线救国"></a>曲线救国</h3><p>刚开始接触混合应用时很喜欢搞一些看上去“很原生”的效果，比如划出菜单、滑动选项卡式列表之类的，后来发现实现是能实现，但结果太糟糕了，因为这些东西太重了，不是web能消费得起的，不要用web的弱点去死磕。</p>
<p>在整体的体验把控上我的看法是，只要功能实现了，有没有某个特效是第二位的，APP的流畅体验和赏心悦目永远是第一位的，尤其要避免任何反常的界面表现，比如web特有的布局抖动和界面先空白后闪现，都会给用户造成“不稳定”的心理暗示，这些问题稍微用点心其实都可以克服。比如frame第一次打开就会出现典型的闪动现象，这时候就需要做预加载，可以参考示例APP的首页第四个栏目，在做了预加载之后有效避免了闪动，而且可以秒开。</p>
<p>像侧滑菜单这种东西，多数情况都可以用一个从左往右打开的页面来代替，流畅性有保证，开发难度也低，不一定非得是侧滑到屏幕一半。</p>
<p>web开发的优势在于布局的灵活性，利用好这一点有时候能让原本不那么好的体验变得可以接受，比如给列表页实现占位元素，实现成本非常低，却能有效降低等待加载的焦虑感，可以参考示例APP的<em>列表到详细页</em>。</p>
<p>总结起来，从绝对性能上混合不可能比得过原生，混合能做的就是用各种手段提高用户的忍耐阈值，或者转移用户的注意力。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>文档正在撰写中，目前线上的文档版本仅供娱乐。</p>
<p>未经实际项目检验，渴望暴风雨猛烈抽打，感兴趣的<a href="https://github.com/tower1229/HybridStart" target="_blank" rel="external">戳此</a>Star。</p>

        
        <p>前端路上原创技术文章，转载请注明出处：<a href="https://refined-x.com/2017/07/07/HybridStart v1.0开发纪要/">https://refined-x.com/2017/07/07/HybridStart v1.0开发纪要/</a></p>
        
        <p><img src="/asset/wechat.jpg" alt="看风景-公众号" style="display:block;max-width:360px;margin:auto" /></p>
        <p style="color:#000;text-align:center;font-weight:bold">不甘平庸的你，快来跟我一起充电吧，关注看风景，获取更多精彩内容。</p>
        
      
    </div>
    <div>
      
        

      
    </div>
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/混合应用/" rel="tag">#混合应用</a>
          
            <a href="/tags/HybridStart/" rel="tag">#HybridStart</a>
          
        </div>
      
      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/03/混合应用框架优化思路梳理/" rel="next" title="混合应用框架优化思路梳理">
                <i class="fa fa-chevron-left"></i> 混合应用框架优化思路梳理
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/10/Hexo自定义页面的方法/" rel="prev" title="Hexo自定义页面的方法">
                Hexo自定义页面的方法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      
      
      
    </footer>
  </article>

    <div class="post-spread">
      
      
    </div>
  </div>

          </div>
          
            <div id="gitment_container"></div>
          
        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
      
      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      
      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="https://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/asset/album.jpg"
               alt="雅X共赏" />
          <p class="site-author-name" itemprop="name">雅X共赏</p>
          <p class="site-description motion-element" itemprop="description">原创前端技术博客，致力于分享前端学习路上的第一手资料。专注web前端开发、移动端开发、前端工程化、前端职业发展，做最有价值的前端技术学习网站。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">39</span>
              <span class="site-state-item-name">前端博客</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">文章标签</span>
              
            </div>
          
        </nav>
        
        <div class="links-of-author motion-element">
          
        </div>
        
        
        

        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">

            <ul class="links-of-blogroll-list booth-list" style="list-style:none">
              
                <li class="links-of-blogroll-item">
                  <a href="https://frontend-weekly.com/" title="前端周刊" target="_blank"><img src="/asset/booth/前端周刊.png" alt="前端周刊" /></a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://frontend-weekly.com/tools.html" title="进阶套装" target="_blank"><img src="/asset/booth/进阶套装.png" alt="进阶套装" /></a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://frontend-weekly.com/program.html" title="0元建站" target="_blank"><img src="/asset/booth/0元建站.png" alt="0元建站" /></a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="/asset/爱奇艺VIP邀请.jpg" title="爱奇艺VIP" target="_blank"><img src="/asset/booth/爱奇艺VIP.png" alt="爱奇艺VIP" /></a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.aliyun.com/minisite/goods?userCode=y31qmczl" title="阿里云双十一" target="_blank"><img src="/asset/booth/阿里云双十一.png" alt="阿里云双十一" /></a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="" title="虚位以待" target="_blank"><img src="/asset/booth/虚位以待.png" alt="虚位以待" /></a>
                </li>
              
            </ul>
          </div>
        

        
        
        
      </section>
      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#核心"><span class="nav-number">1.</span> <span class="nav-text">核心</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#移除依赖"><span class="nav-number">1.1.</span> <span class="nav-text">移除依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#功能梳理"><span class="nav-number">1.2.</span> <span class="nav-text">功能梳理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#核心功能"><span class="nav-number">1.2.1.</span> <span class="nav-text">核心功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#窗口操作"><span class="nav-number">1.2.2.</span> <span class="nav-text">窗口操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内建机制"><span class="nav-number">1.2.3.</span> <span class="nav-text">内建机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据操作"><span class="nav-number">1.2.4.</span> <span class="nav-text">数据操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#设备访问"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">设备访问</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#原生控件"><span class="nav-number">1.2.5.</span> <span class="nav-text">原生控件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UI"><span class="nav-number">2.</span> <span class="nav-text">UI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#css组件"><span class="nav-number">2.1.</span> <span class="nav-text">css组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#js插件"><span class="nav-number">2.2.</span> <span class="nav-text">js插件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">3.</span> <span class="nav-text">其他</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#体验"><span class="nav-number">4.</span> <span class="nav-text">体验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#瓶颈明显"><span class="nav-number">4.1.</span> <span class="nav-text">瓶颈明显</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#曲线救国"><span class="nav-number">4.2.</span> <span class="nav-text">曲线救国</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#后记"><span class="nav-number">5.</span> <span class="nav-text">后记</span></a></li></ol></div>
            
          </div>
        </section>
      
    </div>
  </aside>


        
      </div>
    </main>
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <a href="https://refined-x.com" title="枪在手，跟我走，前端路上不回头" class="author" itemprop="copyrightHolder">雅X共赏</a>
  <span class="with-love">
    全站字数：<span class="post-count">73.6k</span>
  </span>
  
</div>
        
      </div>
    </footer>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>
  







	
  <link rel="stylesheet" href="/lib/gitment/default.css">



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/gitment/gitment.browser.js"></script>


  

  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>

  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>

  
  
  
<script type="text/javascript"> 
var gitment = new Gitment.construct({
    id: 'HybridStart v1.0开发纪要',
    owner: 'tower1229',
    repo: 'blog-comments',
    oauth: {
      client_id: "37db014e1012d7838313",
      client_secret: "52d07c2105210cf845870cb479ae6a4cdecae347",
    },
  })

  gitment.render('gitment_container')
</script>

  
<script type="text/javascript">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</body>
</html>